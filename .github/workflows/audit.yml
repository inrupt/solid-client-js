name: Audit

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  schedule:
    - cron: "40 10 * * *"
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true
jobs:
  audit:
    uses: inrupt/typescript-sdk-tools/.github/workflows/reusable-audit.yml@v2.1.3
    secrets:
      WEBHOOK_E2E_FAILURE: ${{ secrets.WEBHOOK_E2E_FAILURE }}
  dependency-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Download CLI tool 
        shell: bash
        run: |
          latest=$(gh release list --repo https://github.com/jeremylong/DependencyCheck/ --limit  1 | grep -o 'Latest.v[0-9]\+.[0-9]\+.[0-9]\+' | sed "s/Latest.v//")
          wget "https://github.com/jeremylong/DependencyCheck/releases/download/v$latest/dependency-check-$latest-release.zip"
          unzip dependency-check-$latest-release.zip
          bash dependency-check/bin/dependency-check.sh --project "solid-client-authn" --scan . --format SARIF --disableYarnAudit --disableAssembly
          cat dependency-check-report.sarif
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}